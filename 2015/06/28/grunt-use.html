<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no" />
    <title>cobish · Grunt插件的使用</title>
    <link rel="shortcut icon" href="/assets/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/assets/css/index.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/css/prettify.css" media="screen" />
    
</head>

<body>
    <div class="left">
        <!-- 个人信息 -->
<div class="profile-image">
    <img src="/assets/img/profile.png" alt="cobish" />
</div>
<!-- 菜单 -->
<div id="menuBtn" class="menu">
    <div></div>
    <div></div>
    <div></div>
</div>
<h1 class="profile-name">cobish</h1>
<p class="profile-desc">he is a web deleloper.</p>
<!-- 分类 -->
<div class="hr"></div>
<ul id="classify" class="classify">
    <li><a href="/index.html">文章</a></li>
    <li><a href="/page/archieve.html">归档</a></li>
    <li><a href="/page/about.html">关于</a></li>
</ul>
<!-- 联系方式 -->
<div class="hr"></div>
<ul class="contact clearfix">
    <li class="li-first">
        <a class="contact-weibo" href="http://weibo.com/cobish" title="微博" target="_blank">Weibo</a>
    </li>
    <li>
        <a class="contact-github" href="https://github.com/cobish" title="Github" target="_blank">Github</a>
    </li>
    <li>
        <a class="contact-gmail" href="mailto:cobish110@gmail.com" title="Gmail" target="_blank">Gmail</a>
    </li>
</ul>
    </div>
    <div class="right">
        <div class="article">
    <h3 class="article-title">Grunt插件的使用</h3>
    <p class="article-time">Jun 28, 2015</p>
    <div class="article-desc article-content"><h2 id="gruntgrunt">了解Grunt工具与搭建Grunt环境</h2>
<ul>
  <li><a href="http://www.gruntjs.net/" target="_blank">Grunt官网</a></li>
  <li><a href="http://www.w3cplus.com/tools/grunt-tutorial-installing-grunt.html" target="_blank">如何搭建Grunt环境</a></li>
</ul>

<h2 id="grunt">Grunt常用插件的使用</h2>

<h3 id="section">使用之前，对插件进行安装</h3>

<p>package.json文件里写好需要使用到的插件名称与版本，代码如下：</p>

<pre class="prettyprint linenums">
{
    "name": "grunt-demo",
    "version": "1.0.0",
    "devDependencies": {
        "grunt": "^0.4.5"
    }
}
</pre>

<p>在命令行里输入以下命令进行安装，安装完毕将会产生一个名为<code>node_modules</code>的文件夹</p>

<pre class="prettyprint linenums">
$ npm install
</pre>

<p><br /></p>

<h3 id="section-1">图片压缩</h3>

<p>图片压缩使用到的是<code>grunt-contrib-imagemin</code>，安装</p>

<pre class="prettyprint linenums">
npm install grunt-contrib-imagemin --save-dev
</pre>

<p>根据以下配置好路径：</p>

<pre class="prettyprint linenums">
module.exports = function(grunt) {

    // 任务配置
    grunt.initConfig({

        /**
         * 压缩图片大小
         */
        imagemin: {
            dist: {
                files: [{
                    expand: true,
                    cwd: 'src/images',
                    src: ['**/*.{png,gif,jpg,jpeg}'],
                    dest: 'dest/images'
                }]
            }
        }
    });

    // 载入任务
    grunt.loadNpmTasks('grunt-contrib-imagemin');

    // 注册任务
    grunt.registerTask('img', ['imagemin']);
};
</pre>

<p>输入以下命令即可压缩存放在<code>src</code>文件夹下的图片，压缩后的图片保存在<code>dest</code>文件夹下</p>

<pre class="prettyprint linenums">
$ grunt img
</pre>

<p><br /></p>

<h3 id="css">css属性排序</h3>

<p>属性排序使用到的是<code>grunt-csscomb</code>，安装</p>

<pre class="prettyprint linenums">
npm install grunt-csscomb --save-dev
</pre>

<p>配置：</p>

<pre class="prettyprint linenums">
/**
 * css属性排序
 */
csscomb: {
    bar: {
        files: {
            'dest/index.resorted.css': ['src/index.css']
        }
    }
}
</pre>

<p><br /></p>

<h3 id="css-1">css自动添加浏览器厂商前缀</h3>

<p>为了避免书写太多重复的css代码，使用到的是<code>grunt-autoprefixer</code>，安装</p>

<pre class="prettyprint linenums">
npm install grunt-autoprefixer --save-dev
</pre>

<p>配置：</p>

<pre class="prettyprint linenums">
/**
 * 自动添加浏览器厂商前缀
 */
autoprefixer: {
    dist: {
        files: {
            'dest/index.prefixer.css': ['src/index.css']
        }
    }
}
</pre>

<p><br /></p>

<h3 id="js">js代码检测</h3>

<p>代码检测用到的是<code>grunt-contrib-jshint</code>，安装</p>

<pre class="prettyprint linenums">
npm install grunt-contrib-jshint --save-dev
</pre>

<p>配置：</p>

<pre class="prettyprint linenums">
/**
 * js代码检测
 */
jshint: {
    options: {
        // 大括号包裹
        curly: true,

        // 对于首字母大写的函数（声明的类），强制使用new
        newcap: true,

        // 对于简单类型，使用===和!==，而不是==和!=
        eqeqeq: true,

        // 禁用arguments.caller和arguments.callee
        noarg: true,

        // 对于属性使用aaa.bbb而不是aaa['bbb']
        sub: true,

        // 查找所有未定义的变量
        undef: true,
        
        // 查找类似于if(a = 0)的代码
        boss: true
    },
    files: {
        src: ['Gruntfile.js', 'src/*.js']
    }
}
</pre>

<p><br /></p>

<h3 id="css-2">css代码合并与压缩</h3>

<p>css代码合并与压缩用到的是<code>grunt-contrib-cssmin</code></p>

<pre class="prettyprint linenums">
// 任务配置
grunt.initConfig({
    pkg : grunt.file.readJSON('package.json'),

    /**
     * 合并压缩css代码
     */
    cssmin: {
        options: {
            banner: '/*! &lt;%= pkg.name %&gt; &lt;%= grunt.template.today("yyyy-mm-dd") %&gt; */',
            beautify: {
                ascii_only: true
            },

            //设置兼容模式 
            compatibility : 'ie8', 

            //取消高级特性 
            noAdvanced : true,

            // source map
            sourceMap: true
        },
        build: {
            files: {
                'dest/index.min.css': ['src/index1.css', 'src/index2.css']
            }
        }
    }
});
</pre>

<p>输入以下命令即可压缩存放在<code>src</code>文件夹下的css代码，压缩后的css代码保存在<code>dest</code>文件夹下，并生成map文件方便调试</p>

<pre class="prettyprint linenums">
$ grunt cssmin
</pre>

<p><br /></p>

<h3 id="js-1">js代码合并与压缩</h3>

<p>js代码合并与压缩用到的是<code>grunt-contrib-uglify</code></p>

<pre class="prettyprint linenums">
// 任务配置
grunt.initConfig({
    pkg : grunt.file.readJSON('package.json'),

    /**
     * 合并压缩js代码
     */
    uglify: {
        options: {
            banner: '/*! &lt;%= pkg.name %&gt; &lt;%= grunt.template.today("yyyy-mm-dd") %&gt; */',
            sourceMapRoot: '../src/',
            sourceMap: function(path) { 
                return path.replace('.js',".map")
            }
        },
        build: {
            files: {
                'dest/index.min.js': ['src/index1.js', 'src/index2.js']
            }
        }
    }
});
</pre>

<p>输入以下命令即可压缩存放在<code>src</code>文件夹下的js代码，压缩后的js代码保存在<code>dest</code>文件夹下，并生成map文件方便调试</p>

<pre class="prettyprint linenums">
$ grunt uglify
</pre>

<p><br /></p>

<h3 id="section-2">代码监控</h3>

<p>代码监控的主要作用是只要监控到你的css或js代码一旦保存改动，便会做出一系列操作。比如可以使用它来进行合并压缩代码。使用到的插件是<code>grunt-contrib-watch</code>，其中还使用了<code>grunt-newer</code>（作用是只对修改了的文件做操作）</p>

<pre class="prettyprint linenums">
module.exports = function(grunt) {

    // 任务配置
    grunt.initConfig({
        // ...

        /**
         * 监控
         */
        watch: {
            css: {
                files: 'src/css/**/*.css',
                tasks: ['newer:cssmin']
            },
            js: {
                files: 'src/js/**/*.js',
                tasks: ['newer:uglify']
            }
        },
    });

    // 载入任务
    grunt.loadNpmTasks('grunt-contrib-cssmin');
    grunt.loadNpmTasks('grunt-contrib-uglify');
    grunt.loadNpmTasks('grunt-contrib-watch');
    grunt.loadNpmTasks('grunt-newer');

    // 注册任务
    grunt.registerTask('default', ['watch']);
};
</pre>

<p>由于它比较常用，于是把它设置成<code>default</code>，只要输入以下命令，并保持命令行不关闭，它便会一直监听</p>

<pre class="prettyprint linenums">
$ grunt
</pre>

<p><br /></p>

<h3 id="section-3">载入任务简化</h3>

<p>当你的插件较多的时候，loadNpmTasks就会很占地方，这时<code>load-grunt-tasks</code>便起作用了，它会自动地加载你已经安装的插件，而不需要你去手动添加。<code>time-grunt</code>则可以计算出插件运行的时间</p>

<pre class="prettyprint linenums">
// 载入任务
// grunt.loadNpmTasks('grunt-contrib-concat');
// grunt.loadNpmTasks('grunt-contrib-cssmin');
// grunt.loadNpmTasks('grunt-contrib-uglify');
// grunt.loadNpmTasks('grunt-contrib-clean');
// grunt.loadNpmTasks('grunt-contrib-watch');

require('time-grunt')(grunt);
require('load-grunt-tasks')(grunt);
</pre>

<p><br /></p>

<h2 id="demo">demo下载</h2>
<ul>
  <li><a href="https://github.com/cobish/grunt-demo" target="_blank">简单的Grunt例子</a></li>
</ul>
</div>
</div>

<div class="article">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="_posts/2015-06-28-grunt-use.md" data-title="Grunt插件的使用" data-url="/2015/06/28/grunt-use.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"cobish"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>
        <div class="article-bottom"></div>
    </div>
    <script type="text/javascript" src="/assets/js/prettify.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>
    <script type="text/javascript">
    prettyPrint();
    </script>
</body>
</html>